<!doctype html>
<html lang="fr">
<head>
<title>Séquençage WS et SW</title>
<!-- 2016-03-20 Sun 15:56 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Samuel Barreto">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<link href='https://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|Inconsolata' rel='stylesheet' type='text/css'>
<style type="text/css">
  body {
    font-family: 'PT Sans', sans-serif;
  }
  p {
    font-family: 'PT Serif', serif;
  }
</style>
<style type="text/css">
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<script type="text/javascript">
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script>
</head>
<body>
<div id="content" class="container">
<div class="row"><div class="col-md-9"><h1 class="title">Séquençage WS et SW</h1>
<p>
Ce dossier contient les séquences des plaques obtenues avec les
constructions SW et WS, envoyées à séquencer le <span class="timestamp-wrapper"><span class="timestamp">[2016-03-15 Tue]</span></span>. 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Dossiers et fichiers</h2>
<div class="outline-text-2" id="text-1">
<p>
Les données brutes au format .zip sont dans le dossier <code>raw</code>. Elles
sont extraites dans le dossier <code>data</code>, séparé en <code>ws</code> et <code>sw</code> pour les
analyses. Rien ne doit toucher au dossier <code>raw</code>. 
</p>

<p>
J'ai ensuite utilisé le script <a href="./src/sort_into_dir.sh">./src/sort_into_dir.sh</a> pour classer les
fichiers selon leur extension. 
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #586e75;">#</span><span style="color: #586e75;">!/bin/</span><span style="color: #859900; font-weight: bold;">bash</span>

<span style="color: #839496; font-weight: bold;">cd</span> data/ws

mkdir fasta spectro seq

find . -name <span style="color: #2aa198;">"*.fas"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ./fasta/ <span style="color: #2aa198;">\;</span>
find . -name <span style="color: #2aa198;">"*.ab1"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ./spectro/ <span style="color: #2aa198;">\;</span>
find . -name <span style="color: #2aa198;">"*.seq"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ./seq/ <span style="color: #2aa198;">\;</span>
find . -name <span style="color: #2aa198;">"*.csv"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ../csv/ <span style="color: #2aa198;">\;</span>

<span style="color: #839496; font-weight: bold;">cd</span> ../sw

mkdir fasta spectro seq

find . -name <span style="color: #2aa198;">"*.fas"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ./fasta/ <span style="color: #2aa198;">\;</span>
find . -name <span style="color: #2aa198;">"*.ab1"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ./spectro/ <span style="color: #2aa198;">\;</span>
find . -name <span style="color: #2aa198;">"*.seq"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ./seq/ <span style="color: #2aa198;">\;</span>
find . -name <span style="color: #2aa198;">"*.csv"</span>  -maxdepth <span style="color: #6c71c4;">1</span> -exec mv <span style="color: #2aa198;">{}</span> ../csv/ <span style="color: #2aa198;">\;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Contrôle qualité</h2>
<div class="outline-text-2" id="text-2">
<p>
Après avoir reçu les séquences, j'ai voulu connaître la qualité
globale des séquences. Je les ai donc converties en fastq avec le
script <a href="./src/ab1_to_fastq.sh">./src/ab1_to_fastq.sh</a>, et j'ai utilisé <code>fastqc</code> pour
représenter la qualité globale via le script <a href="./src/quality_control.sh">./src/quality_control.sh</a>.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #586e75;">#</span><span style="color: #586e75;">!/bin/</span><span style="color: #859900; font-weight: bold;">bash</span>

<span style="color: #586e75;"># </span><span style="color: #586e75;">transforme en fastq</span>
<span style="color: #839496; font-weight: bold;">cd</span> data/ws

touch ws_untrimmed.fastq

<span style="color: #859900; font-weight: bold;">for</span> file<span style="color: #859900; font-weight: bold;"> in</span> spectro/*.ab1
<span style="color: #859900; font-weight: bold;">do</span>
    seqret <span style="color: #b58900; font-weight: bold;">\</span>
        -sformat abi <span style="color: #b58900; font-weight: bold;">\</span>
        -osformat fastq <span style="color: #b58900; font-weight: bold;">\</span>
        -auto <span style="color: #b58900; font-weight: bold;">\</span>
        -stdout <span style="color: #b58900; font-weight: bold;">\</span>
        -sequence $<span style="color: #268bd2;">file</span> <span style="color: #b58900; font-weight: bold;">\</span>
        &gt;&gt; ws_untrimmed.fastq
<span style="color: #859900; font-weight: bold;">done</span>

<span style="color: #839496; font-weight: bold;">cd</span> ../sw

<span style="color: #586e75;"># </span><span style="color: #586e75;">TEMPORAIRE, &#233;limine le fichier .ab1 tendancieux pour l'instant</span>
rm spectro/psw76-1073bis.ab1

touch sw_untrimmed.fastq

<span style="color: #859900; font-weight: bold;">for</span> file<span style="color: #859900; font-weight: bold;"> in</span> spectro/*.ab1
<span style="color: #859900; font-weight: bold;">do</span>
    seqret <span style="color: #b58900; font-weight: bold;">\</span>
        -sformat abi <span style="color: #b58900; font-weight: bold;">\</span>
        -osformat fastq <span style="color: #b58900; font-weight: bold;">\</span>
        -auto <span style="color: #b58900; font-weight: bold;">\</span>
        -stdout <span style="color: #b58900; font-weight: bold;">\</span>
        -sequence $<span style="color: #268bd2;">file</span> <span style="color: #b58900; font-weight: bold;">\</span>
        &gt;&gt; sw_untrimmed.fastq
<span style="color: #859900; font-weight: bold;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #586e75;">#</span><span style="color: #586e75;">!/bin/</span><span style="color: #859900; font-weight: bold;">bash</span>

<span style="color: #586e75;"># </span><span style="color: #586e75;">contr&#244;le qualit&#233; des s&#233;quences.</span>
<span style="color: #839496; font-weight: bold;">cd</span> data

<span style="color: #586e75;"># </span><span style="color: #586e75;">cr&#233;e un dossier qc de quality control pour ws et sw</span>
mkdir -p qc/<span style="color: #2aa198;">{</span>ws,sw<span style="color: #2aa198;">}</span>

<span style="color: #586e75;"># </span><span style="color: #586e75;">fastqc sortie dasn le dossier appropri&#233;</span>
fastqc ws/ws_untrimmed.fastq -o qc/ws
fastqc sw/sw_untrimmed.fastq -o qc/sw

<span style="color: #586e75;"># </span><span style="color: #586e75;">transfert du fichier .png qui nous int&#233;resse dans le dir adapt&#233;</span>
<span style="color: #586e75;"># </span><span style="color: #586e75;">et suppression des dossiers inutiles</span>
<span style="color: #586e75;">#</span><span style="color: #586e75;">' -qq : very quiet</span>
<span style="color: #586e75;">#</span><span style="color: #586e75;">' -o  : overwrite without warning</span>
<span style="color: #586e75;">#</span><span style="color: #586e75;">' -d  : out dir</span>
unzip -qq -o <span style="color: #b58900; font-weight: bold;">\</span>
      qc/sw/sw_untrimmed_fastqc.zip <span style="color: #b58900; font-weight: bold;">\</span>
      sw_untrimmed_fastqc/Images/per_base_quality.png <span style="color: #b58900; font-weight: bold;">\</span>
      -d ../anl/ <span style="color: #b58900; font-weight: bold;">\</span>
    &amp;&amp; mv ../anl/sw_untrimmed_fastqc/Images/per_base_quality.png <span style="color: #b58900; font-weight: bold;">\</span>
          ../anl/sw_per_base_qual.png <span style="color: #b58900; font-weight: bold;">\</span>
    &amp;&amp; rm -r ../anl/sw_untrimmed_fastqc

<span style="color: #586e75;"># </span><span style="color: #586e75;">transfert du fichier .png qui nous int&#233;resse dans le dir adapt&#233;</span>
<span style="color: #586e75;"># </span><span style="color: #586e75;">et suppression des dossiers inutiles</span>
unzip -qq -o <span style="color: #b58900; font-weight: bold;">\</span>
      qc/ws/ws_untrimmed_fastqc.zip <span style="color: #b58900; font-weight: bold;">\</span>
      ws_untrimmed_fastqc/Images/per_base_quality.png <span style="color: #b58900; font-weight: bold;">\</span>
      -d ../anl/ <span style="color: #b58900; font-weight: bold;">\</span>
    &amp;&amp; mv ../anl/ws_untrimmed_fastqc/Images/per_base_quality.png <span style="color: #b58900; font-weight: bold;">\</span>
          ../anl/ws_per_base_qual.png <span style="color: #b58900; font-weight: bold;">\</span>
    &amp;&amp; rm -r ../anl/ws_untrimmed_fastqc
</pre>
</div>

<p>
À priori les séquences sont plutôt de bonne qualité. Voir le résumé
dans le fichier <a href="./data/qc/sw/sw_untrimmed_fastqc.html">./data/qc/sw/sw_untrimmed_fastqc.html</a> et
<a href="./data/qc/ws/ws_untrimmed_fastqc.html">./data/qc/ws/ws_untrimmed_fastqc.html</a>. 
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Analyse rapide du SNP calling de GATC</h2>
<div class="outline-text-2" id="text-3">
<p>
J'ai rapidement analysé la sortie du SNP calling effectué par GATC,
mais il manque des données. Je vais refaire le SNP calling moi-même,
en utilisant polySNP pour screener la présence éventuelle de double
pics. 
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> ---</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> title: "Rapide analyse des SNP"</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> author: "Samuel BARRETO"</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> date: "31 janvier 2016"</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> output:</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;">   html_document:</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;">     highlight: tango</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;">     theme: journal</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;">     toc: yes</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> ---</span>

<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> # Lecture des donn&#233;es</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> Les donn&#233;es sont les tableurs de snp calling que GATC nous a fait</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> gratuitement. Ce script n'est que pr&#233;liminaire, je referai le snp</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> calling comme il faut par la suite.</span>

<span style="color: #268bd2; font-weight: bold;">library</span><span style="color: #2aa198; font-weight: bold;">(</span>dplyr<span style="color: #2aa198; font-weight: bold;">)</span>
<span style="color: #268bd2; font-weight: bold;">library</span><span style="color: #2aa198; font-weight: bold;">(</span>ggplot2<span style="color: #2aa198; font-weight: bold;">)</span>
<span style="color: #268bd2; font-weight: bold;">library</span><span style="color: #2aa198; font-weight: bold;">(</span>readr<span style="color: #2aa198; font-weight: bold;">)</span>
<span style="color: #268bd2; font-weight: bold;">library</span><span style="color: #2aa198; font-weight: bold;">(</span>viridis<span style="color: #2aa198; font-weight: bold;">)</span>

<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> Lecture des donn&#233;es et combinaison dans un seul tableur. </span>
ws <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #268bd2;">read_delim</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #2aa198;">"../../data/csv/1582203.SNP.csv"</span>, delim <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #2aa198;">";"</span><span style="color: #2aa198; font-weight: bold;">)</span>
sw <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #268bd2;">read_delim</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #2aa198;">"../../data/csv/1582443.SNP.csv"</span>, delim <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #2aa198;">";"</span><span style="color: #2aa198; font-weight: bold;">)</span>
ws$type <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #2aa198;">"ws"</span>
sw$type <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #2aa198;">"sw"</span>

<span style="color: #586e75;">## </span><span style="color: #586e75;">#' une fonction qui d&#233;finit le type de transition, de la r&#233;f&#233;rence &#224; la s&#233;quence observ&#233;e. </span>
<span style="color: #268bd2;">find_transition</span> <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #859900; font-weight: bold;">function</span><span style="color: #2aa198; font-weight: bold;">(</span>ref, base<span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #2aa198; font-weight: bold;">{</span>
  <span style="color: #268bd2;">stopifnot</span><span style="color: #b58900; font-weight: bold;">(</span><span style="color: #268bd2;">typeof</span><span style="color: #268bd2; font-weight: bold;">(</span>ref<span style="color: #268bd2; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">==</span> <span style="color: #2aa198;">"character"</span>,
            <span style="color: #268bd2;">typeof</span><span style="color: #268bd2; font-weight: bold;">(</span>base<span style="color: #268bd2; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">==</span> <span style="color: #2aa198;">"character"</span><span style="color: #b58900; font-weight: bold;">)</span>

  <span style="color: #268bd2;">is_W</span> <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #859900; font-weight: bold;">function</span><span style="color: #b58900; font-weight: bold;">(</span>base<span style="color: #b58900; font-weight: bold;">)</span> <span style="color: #268bd2;">ifelse</span><span style="color: #b58900; font-weight: bold;">(</span>base <span style="color: #268bd2; font-weight: bold;">==</span> <span style="color: #2aa198;">"A"</span> || base <span style="color: #268bd2; font-weight: bold;">==</span> <span style="color: #2aa198;">"T"</span>, <span style="color: #b58900;">TRUE</span>, <span style="color: #b58900;">FALSE</span><span style="color: #b58900; font-weight: bold;">)</span>
  <span style="color: #268bd2;">is_S</span> <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #859900; font-weight: bold;">function</span><span style="color: #b58900; font-weight: bold;">(</span>base<span style="color: #b58900; font-weight: bold;">)</span> <span style="color: #268bd2;">ifelse</span><span style="color: #b58900; font-weight: bold;">(</span>base <span style="color: #268bd2; font-weight: bold;">==</span> <span style="color: #2aa198;">"C"</span> || base <span style="color: #268bd2; font-weight: bold;">==</span> <span style="color: #2aa198;">"G"</span>, <span style="color: #b58900;">TRUE</span>, <span style="color: #b58900;">FALSE</span><span style="color: #b58900; font-weight: bold;">)</span>

  <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900; font-weight: bold;">(</span><span style="color: #268bd2;">is_W</span><span style="color: #268bd2; font-weight: bold;">(</span>ref<span style="color: #268bd2; font-weight: bold;">)</span> &amp; <span style="color: #268bd2;">is_S</span><span style="color: #268bd2; font-weight: bold;">(</span>base<span style="color: #268bd2; font-weight: bold;">)</span><span style="color: #b58900; font-weight: bold;">)</span> <span style="color: #2aa198;">"ws"</span>
  <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900; font-weight: bold;">(</span><span style="color: #268bd2;">is_S</span><span style="color: #268bd2; font-weight: bold;">(</span>ref<span style="color: #268bd2; font-weight: bold;">)</span> &amp; <span style="color: #268bd2;">is_W</span><span style="color: #268bd2; font-weight: bold;">(</span>base<span style="color: #268bd2; font-weight: bold;">)</span><span style="color: #b58900; font-weight: bold;">)</span> <span style="color: #2aa198;">"sw"</span>
  <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900; font-weight: bold;">(</span><span style="color: #268bd2;">is_S</span><span style="color: #268bd2; font-weight: bold;">(</span>ref<span style="color: #268bd2; font-weight: bold;">)</span> &amp; <span style="color: #268bd2;">is_S</span><span style="color: #268bd2; font-weight: bold;">(</span>base<span style="color: #268bd2; font-weight: bold;">)</span><span style="color: #b58900; font-weight: bold;">)</span> <span style="color: #2aa198;">"ss"</span>
  <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900; font-weight: bold;">(</span><span style="color: #268bd2;">is_W</span><span style="color: #268bd2; font-weight: bold;">(</span>ref<span style="color: #268bd2; font-weight: bold;">)</span> &amp; <span style="color: #268bd2;">is_W</span><span style="color: #268bd2; font-weight: bold;">(</span>base<span style="color: #268bd2; font-weight: bold;">)</span><span style="color: #b58900; font-weight: bold;">)</span> <span style="color: #2aa198;">"ww"</span>
  <span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900; font-weight: bold;">stop</span><span style="color: #b58900; font-weight: bold;">(</span><span style="color: #2aa198;">"Base "</span>, ref, <span style="color: #2aa198;">" or base "</span>, base, <span style="color: #2aa198;">" is not a DNA base."</span>, call. <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #b58900;">FALSE</span><span style="color: #b58900; font-weight: bold;">)</span>
<span style="color: #2aa198; font-weight: bold;">}</span>

data <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #268bd2;">rbind</span><span style="color: #2aa198; font-weight: bold;">(</span>ws, sw<span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #586e75;"># </span><span style="color: #586e75;">lie les deux jeux de donn&#233;es</span>
<span style="color: #268bd2;">colnames</span><span style="color: #2aa198; font-weight: bold;">(</span>data<span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">&lt;-</span>  <span style="color: #268bd2;">c</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #2aa198;">"ref"</span>, <span style="color: #2aa198;">"pos"</span>, <span style="color: #2aa198;">"ref.base"</span>, <span style="color: #2aa198;">"alt.base"</span>, <span style="color: #2aa198;">"qual"</span>,
                     <span style="color: #2aa198;">"query"</span>, <span style="color: #2aa198;">"qpos"</span>, <span style="color: #2aa198;">"qlen"</span>, <span style="color: #2aa198;">"type"</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #586e75;"># </span><span style="color: #586e75;">change les noms de colonne</span>
data <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #268bd2;">mutate</span><span style="color: #2aa198; font-weight: bold;">(</span>data, query <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #268bd2;">gsub</span><span style="color: #b58900; font-weight: bold;">(</span><span style="color: #2aa198;">"-1073bis"</span>, <span style="color: #2aa198;">""</span>, query<span style="color: #b58900; font-weight: bold;">)</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #586e75;"># </span><span style="color: #586e75;">supprime le nom de l'amorce</span>

<span style="color: #586e75;">## </span><span style="color: #586e75;">ggplot default theme</span>
<span style="color: #268bd2;">theme_set</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #268bd2;">theme_minimal</span><span style="color: #b58900; font-weight: bold;">(</span>base_size <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #b58900;">10</span>, base_family <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #2aa198;">"Courier"</span><span style="color: #b58900; font-weight: bold;">)</span><span style="color: #2aa198; font-weight: bold;">)</span>

<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> Je regarde la distribution des SNP sur les s&#233;quences</span>
<span style="color: #586e75;">#</span><span style="color: #586e75;">+ distrisnp</span>
data <span style="color: #268bd2; font-weight: bold;">%&gt;%</span>
  <span style="color: #268bd2;">ggplot</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #268bd2;">aes</span><span style="color: #b58900; font-weight: bold;">(</span>x <span style="color: #268bd2; font-weight: bold;">=</span> pos, fill <span style="color: #268bd2; font-weight: bold;">=</span> type<span style="color: #b58900; font-weight: bold;">)</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">+</span>
  <span style="color: #268bd2;">geom_histogram</span><span style="color: #2aa198; font-weight: bold;">(</span>binwidth <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #b58900;">10</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">+</span>
  <span style="color: #268bd2;">facet_grid</span><span style="color: #2aa198; font-weight: bold;">(</span>type~.<span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">+</span>
  <span style="color: #268bd2;">xlab</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #2aa198;">"Position sur la reference"</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">+</span>
  <span style="color: #268bd2;">ylab</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #2aa198;">"Nombre de SNP"</span><span style="color: #2aa198; font-weight: bold;">)</span>

<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> Je fais rapidement un petit alignement des s&#233;quences</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span>
data <span style="color: #268bd2; font-weight: bold;">%&gt;%</span>
  <span style="color: #268bd2;">ggplot</span><span style="color: #2aa198; font-weight: bold;">(</span>data <span style="color: #268bd2; font-weight: bold;">=</span> ., <span style="color: #268bd2;">aes</span><span style="color: #b58900; font-weight: bold;">(</span>x <span style="color: #268bd2; font-weight: bold;">=</span> pos, y  <span style="color: #268bd2; font-weight: bold;">=</span> query <span style="color: #b58900; font-weight: bold;">)</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">+</span>
  <span style="color: #586e75;">## </span><span style="color: #586e75;">geom_text(aes(label = alt.base)) +</span>
  <span style="color: #268bd2;">geom_point</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #268bd2;">aes</span><span style="color: #b58900; font-weight: bold;">(</span>color <span style="color: #268bd2; font-weight: bold;">=</span> alt.base<span style="color: #b58900; font-weight: bold;">)</span>, alpha <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #b58900;">0.4</span><span style="color: #2aa198; font-weight: bold;">)</span>

data <span style="color: #268bd2; font-weight: bold;">%&gt;%</span>
  <span style="color: #268bd2;">group_by</span><span style="color: #2aa198; font-weight: bold;">(</span>query<span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">%&gt;%</span>
  <span style="color: #268bd2;">summarise</span><span style="color: #2aa198; font-weight: bold;">(</span>end.tc <span style="color: #268bd2; font-weight: bold;">=</span> <span style="color: #268bd2;">max</span><span style="color: #b58900; font-weight: bold;">(</span>pos<span style="color: #b58900; font-weight: bold;">)</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">%&gt;%</span>
  <span style="color: #268bd2;">ggplot</span><span style="color: #2aa198; font-weight: bold;">(</span><span style="color: #268bd2;">aes</span><span style="color: #b58900; font-weight: bold;">(</span>x <span style="color: #268bd2; font-weight: bold;">=</span> end.tc<span style="color: #b58900; font-weight: bold;">)</span><span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">+</span>
  <span style="color: #268bd2;">geom_histogram</span><span style="color: #2aa198; font-weight: bold;">()</span>

data <span style="color: #268bd2; font-weight: bold;">%&gt;%</span> <span style="color: #268bd2;">select</span><span style="color: #2aa198; font-weight: bold;">(</span>query<span style="color: #2aa198; font-weight: bold;">)</span> <span style="color: #268bd2; font-weight: bold;">%&gt;%</span> <span style="color: #268bd2;">unique</span><span style="color: #2aa198; font-weight: bold;">()</span>

<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> Il n'y a que 127 s&#233;quences analys&#233;es dans ce tableau. &#199;a ne va pas.</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> On devrait s'attendre &#224; 192 s&#233;quences normalement. Il manque du</span>
<span style="color: #586e75; font-weight: bold;">#</span><span style="color: #586e75; font-weight: bold;">'</span><span style="color: #586e75;"> signal. Je vais faire l'analyse moi-m&#234;me.</span>
</pre>
</div>

<p>
Le script est là <a href="./anl/snp_call/snp_call.r">./anl/snp_call/snp_call.r</a>, les sorties en
html là <a href="./anl/snp_call/snp_call.html">./anl/snp_call/snp_call.html</a>.
</p>
</div>
</div>
</div><div class="col-md-3"><nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar">
<ul class="nav">
<li><a href="#sec-1">1. Dossiers et fichiers</a></li>
<li><a href="#sec-2">2. Contrôle qualité</a></li>
<li><a href="#sec-3">3. Analyse rapide du SNP calling de GATC</a></li>
</ul>
</div>
</nav>
</div></div></div>
<footer id="postamble" class="">
<div><p class="author">Auteur: Samuel Barreto</p>
<p class="date">Created: 2016-03-20 Sun 15:56</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org-mode</a> 8.3.4)</p>
</div>
</footer>
</body>
</html>
